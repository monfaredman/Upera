(window.webpackJsonp=window.webpackJsonp||[]).push([[38,11],{711:function(t,e,n){"use strict";var r=n(25),o=n(146).findIndex,l=n(166),d="findIndex",c=!0;d in[]&&Array(1)[d](function(){c=!1}),r({target:"Array",proto:!0,forced:c},{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),l(d)},715:function(t,e,n){t.exports={}},721:function(t,e,n){"use strict";n.r(e);n(34),n(45),n(40),n(17),n(21),n(22),n(16);var r=n(23),o=n(69),l=n(50),d=n(3),c=(n(58),n(13),n(711),n(758),n(44),n(168),n(760),n(134),n(18),n(11),n(440),n(29),n(46),n(35));function m(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function v(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?m(Object(n),!0).forEach(function(e){Object(d.a)(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}var h={name:"Download",props:{show:Boolean,staticmodal:Boolean,viewOnly:{type:Boolean,default:!1},id:{type:String,default:null},posterf:{type:String,default:null},backdrop:{type:String,default:null},name:{type:String,default:null},namefa:{type:String,default:null},type:{type:String,default:null},itemdata:{type:Object,default:null},season:{type:[Array,Object],default:null}},data:function(){return{loading:!1,error:null,processing:!1,paymentMethod:"sep",mobile:null,mobileError:"",useWallet:!1,useWalletCredit:!1,showAddMoreDropdown:!1,addedItems:[],availableItems:[],paymentMethods:[{value:"sep",name:"درگاه بانکی",description:"پرداخت با کلیه کارت‌های بانکی",icon:"BankIcon",src:"Shaparak.png"},{value:"directdebit",name:"پرداخت خودکار",description:"پرداخت با اعتبار حساب آپرا",icon:"OperaCreditIcon",src:"directdebit.png"}]}},computed:v(v(v({},Object(c.c)({user:"auth/user"})),Object(c.c)({my_credit:"my_credit"})),{},{userState:function(){var t;return this.$auth.loggedIn?null!==(t=this.$store)&&void 0!==t&&null!==(t=t.state)&&void 0!==t&&t.basketActive?1:2:3},userLogin:function(){return this.$auth.loggedIn},showAddMoreButton:function(){var t;return null===(t=this.$store)||void 0===t||null===(t=t.state)||void 0===t?void 0:t.basketActive},showPaymentMethods:function(){return 1===this.userState||2===this.userState},showWalletSection:function(){return 1===this.userState||2===this.userState},showMobileInput:function(){return 3===this.userState},subtotalAmount:function(){return this.addedItems.reduce(function(t,e){return t+e.tvod_price},0)},taxAmount:function(){return Math.floor(.1*this.subtotalAmount)},totalAmount:function(){return this.subtotalAmount+this.taxAmount},canPurchase:function(){return 1===this.userState||2===this.userState?this.subtotalAmount>0:3===this.userState&&(this.subtotalAmount>0&&this.mobile&&!this.mobileError)},hasEnoughWalletBalance:function(){return this.myCreditValue>=this.totalAmount},myCreditValue:function(){if(!this.my_credit)return 0;var t=this.my_credit.replace(/[^\d.]/g,"");return Number(t)||0}}),watch:{show:function(t){if(t){this.showModal(),this.syncWithCart();var e=!1;try{(e="1"===localStorage.getItem("_download_skip_main_item"))&&localStorage.removeItem("_download_skip_main_item")}catch(t){console.error("Failed to read skip flag:",t)}this.viewOnly||e||this.loadContentData(this.type,this.id),this.loadAvailableItems()}else this.hideModal()},useWalletCredit:function(t){this.paymentMethod=t?"credit":"sep"},addedItems:{deep:!0,handler:function(){this.syncToCart()}}},mounted:function(){this.setupModalEvents(),this.syncWithCart(),this.show&&(this.showModal(),this.viewOnly||this.loadContentData(this.type,this.id),this.loadAvailableItems())},methods:{setupModalEvents:function(){var t,e=this;null===(t=this.$refs.downloadLinks)||void 0===t||t.$on("hide",function(){e.cleanup(),e.$emit("hide-modal")})},syncWithCart:function(){try{var t;if(null===(t=this.$store)||void 0===t||null===(t=t.state)||void 0===t||!t.basketActive)return localStorage.removeItem("_cart"),this.addedItems=[],void this.emitCartChange();var e=localStorage.getItem("_cart");if(e){var n=JSON.parse(e);n.content&&Array.isArray(n.content)&&(this.addedItems=n.content)}}catch(t){console.error("Error syncing with cart:",t)}},syncToCart:function(){try{var t;if(null===(t=this.$store)||void 0===t||null===(t=t.state)||void 0===t||!t.basketActive)return localStorage.removeItem("_cart"),void this.emitCartChange();var e={content:Array.isArray(this.addedItems)?this.addedItems.map(function(t){return t&&"object"===Object(l.a)(t)?v(v({},t),{},{id:void 0!==t.id&&null!==t.id?String(t.id):t.id}):t}):[],amount:this.totalAmount};localStorage.setItem("_cart",JSON.stringify(e)),this.emitCartChange()}catch(t){console.error("Error syncing to cart:",t)}},emitCartChange:function(){try{var t=new StorageEvent("storage",{key:"_cart"});window.dispatchEvent(t)}catch(t){window.dispatchEvent(new Event("storage"))}this.$root.$emit("cart-updated")},addToCart:function(t){try{var e;if(null===(e=this.$store)||void 0===e||null===(e=e.state)||void 0===e||!e.basketActive)return this.addedItems=[t],localStorage.removeItem("_cart"),void this.emitCartChange();var n=localStorage.getItem("_cart"),r=n?JSON.parse(n):{content:[]},content=Array.isArray(r.content)?Object(o.a)(r.content):[],l=content.findIndex(function(e){return(null==e?void 0:e.id)===t.id});-1===l?content.push(t):content.splice(l,1,t),this.addedItems=content}catch(t){console.error("Error adding to cart:",t)}},removeFromCart:function(t){try{var e;if(null===(e=this.$store)||void 0===e||null===(e=e.state)||void 0===e||!e.basketActive)return this.addedItems=this.addedItems.filter(function(e){return e.id!==t}),localStorage.removeItem("_cart"),void this.emitCartChange();var n=localStorage.getItem("_cart"),r=n?JSON.parse(n):{content:[]},content=Array.isArray(r.content)?r.content.filter(function(e){return(null==e?void 0:e.id)!==t}):[];this.addedItems=content}catch(t){console.error("Error removing from cart:",t)}},loadContentData:function(t,e){var n=this;return Object(r.a)(regeneratorRuntime.mark(function r(){var o,l,d,c,m,h,f;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n.loading=!0,n.error=null,r.prev=1,"movie"===t?d="/getV2/movie/".concat(e):"episode"!==t&&"series"!==t||(d="/getV2/episode/".concat(e)),r.next=2,n.$axios.get(d);case 2:c=r.sent,m=c.data,h=null,h=null!=m&&null!==(o=m.data)&&void 0!==o&&o.episode?v(v({},m.data.episode),{},{cdn:m.data.cdn}):null!=m&&null!==(l=m.data)&&void 0!==l&&l.movie?v(v({},m.data.movie),{},{cdn:m.data.cdn}):null!=m&&m.data?m.data:m,n.addToCart(h),r.next=4;break;case 3:r.prev=3,f=r.catch(1),n.error="خطا در بارگذاری اطلاعات محتوا",console.error("Error loading content data:",f);case 4:return r.prev=4,n.showAddMoreDropdown=!1,n.loading=!1,r.finish(4);case 5:case"end":return r.stop()}},r,null,[[1,3,4,5]])}))()},loadAvailableItems:function(){this.season&&"object"===Object(l.a)(this.season)?this.availableItems=Object.values(this.season).flat():this.availableItems=[]},getContentTitle:function(t){if(t){var e=t.name||t.title,n=t.name_fa||t.title_fa,title=this.chooseLang(e,n);if(title)return title}return this.chooseLang(this.name,this.namefa)},getContentTitleHeader:function(){var t,e,n;return"series"===(null===(t=this.addedItems[0])||void 0===t?void 0:t.type)?"خرید سریال ":"episode"===(null===(e=this.addedItems[0])||void 0===e?void 0:e.type)?"خرید قسمت ":"movie"===(null===(n=this.addedItems[0])||void 0===n?void 0:n.type)?"خرید فیلم ":void 0},formatPrice:function(t){if(!t)return"0";var e=String(t),n=e.length;return 4===n?e.substring(0,1)+"."+e.substring(1):5===n?e.substring(0,2)+"."+e.substring(2):3===n?e:e.substring(0,3)+"."+e.substring(3)},removeItem:function(){this.hideModal()},addItem:function(t){this.loadContentData(t.type,t.id),this.showAddMoreDropdown=!0},removeAddedItem:function(t){this.addedItems.length<=1?this.hideModal():this.removeFromCart(t)},validateMobile:function(){this.mobile?/^09[0-9]{9}$/.test(this.mobile)?this.mobileError="":this.mobileError="شماره موبایل معتبر نیست":this.mobileError="شماره موبایل الزامی است"},handlePurchase:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark(function e(){var n,r,o,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.canPurchase){e.next=1;break}return e.abrupt("return");case 1:if("directdebit"!==t.paymentMethod){e.next=2;break}return t.hideModal(),t.$store.dispatch("directdebit/SHOW_MODAL",{premobile:null,forsubscription:!1,id:null,type:null,paymentid:0}),e.abrupt("return");case 2:return t.processing=!0,e.prev=3,n={},n=t.userLogin?{method:t.paymentMethod,cart:[],ekran:0,callback_url:"https://upera.tv/callback",ref:0,sms:!1,mobile:t.mobile}:{method:t.paymentMethod,cart:[],ekran:0,callback_url:"https://upera.tv/callback",ref:0,sms:!1},t.addedItems.length>0&&(n.cart=t.addedItems.map(function(t){return"movie"===t.type?{movie_id:t.id}:{episode_id:t.id}})),3===t.userState&&(n.mobile=t.mobile),r=t.userLogin?"/get/buy":"/ghost/get/buy",e.next=4,t.$axios.post(r,n);case 4:(o=e.sent).data.data.pay_url?window.location.href=o.data.data.pay_url:t.error="خطا در ایجاد لینک پرداخت",e.next=7;break;case 5:if(e.prev=5,!((l=e.catch(3)).response&&l.response.data&&l.response.data.message)){e.next=6;break}return t.error=l.response.data.message,e.abrupt("return");case 6:t.error="خطا در انجام عملیات پرداخت";case 7:return e.prev=7,t.processing=!1,e.finish(7);case 8:case"end":return e.stop()}},e,null,[[3,5,7,8]])}))()},cleanup:function(){this.error=null,this.mobile=null,this.mobileError="",this.useWallet=!1,this.showAddMoreDropdown=!1,this.availableItems=[]},chooseLang:function(t,e){return e&&"fa"==this.$i18n.locale?e:t},showModal:function(){var t;null===(t=this.$refs.downloadLinks)||void 0===t||t.show()},hideModal:function(){var t;null===(t=this.$refs.downloadLinks)||void 0===t||t.hide(),this.$emit("hide-modal",null),this.cleanup()},posterSrc:function(t){if(!t)return"";var e=142,n=212;return"".concat("https://thumb.upera.shop/thumb","?w=").concat(e,"&h=").concat(n,"&q=100&a=c&src=").concat("https://cdn.upera.shop/s3/posters","/").concat(t)},redirectToItem:function(){this.hideModal(),this.$router.push("episode"===this.type?{name:"episode-id",params:{id:this.$route.params.id}}:"movie"===this.type?{name:"movie-id",params:{id:this.$route.params.id}}:{name:"series-id",params:{id:this.$route.params.id}})}}},f=(n(761),n(28)),component=Object(f.a)(h,function(){var t=this,e=t._self._c;return e("div",[e("b-modal",{ref:"downloadLinks",attrs:{id:"downloadLinks",centered:!t.staticmodal,"hide-footer":"","hide-header":"",size:"lg","no-close-on-backdrop":t.staticmodal,"hide-backdrop":t.staticmodal,"no-close-on-esc":t.staticmodal,"modal-class":"modal-download-link",static:t.staticmodal,"no-enforce-focus":""}},[e("div",{staticClass:"download-links"},[e("div",{staticClass:"top-section"},[e("div",{staticClass:"download-links-header-simple"},[e("div",{staticClass:"download-links-title-simple"},[t._v("\n            "+t._s(t.getContentTitleHeader())+"\n          ")]),t._v(" "),e("button",{directives:[{name:"show",rawName:"v-show",value:!t.staticmodal,expression:"!staticmodal"}],staticClass:"close",attrs:{type:"button"},on:{click:t.hideModal}},[e("i",{staticClass:"fas fa-times",style:{color:"dark"===t.$colorMode.value?"white":"black"}})])]),t._v(" "),e("div",{staticClass:"download-links-body-simple"},[t.loading?e("div",{staticClass:"loading-state"},[e("div",{staticClass:"spinner-border",attrs:{role:"status"}},[e("span",{staticClass:"sr-only"},[t._v("Loading...")])]),t._v(" "),e("p",[t._v("در حال بارگذاری...")])]):t.error?e("div",{staticClass:"error-state"},[e("p",{staticClass:"text-danger"},[t._v(t._s(t.error))]),t._v(" "),e("button",{staticClass:"btn btn-primary",on:{click:function(e){return t.loadContentData(t.type,t.id)}}},[t._v("\n              تلاش مجدد\n            ")])]):e("div",{staticClass:"tvod-content"},[e("div",{staticClass:"content-card"},[t.addedItems.length>0?e("div",{staticClass:"added-items-list"},t._l(t.addedItems,function(n){return e("div",{key:n.id,staticClass:"added-item-card"},[e("div",{staticClass:"card-content"},[e("div",{staticClass:"card-image"},[e("img",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],attrs:{"data-src":t.posterSrc(n.poster),alt:"Poster"}})]),t._v(" "),e("div",{staticClass:"card-details"},[e("div",{staticClass:"content-name"},[t._v("\n                        "+t._s(t.getContentTitle(n))+"\n                      ")]),t._v(" "),e("div",{staticClass:"content-info"},[n.season_number&&n.episode_number?e("span",[t._v("\n                          فصل "+t._s(n.season_number)+" - قسمت\n                          "+t._s(n.episode_number)+"\n                        ")]):t._e()]),t._v(" "),e("div",{staticClass:"content-price"},[t._v("\n                        "+t._s(t.formatPrice(n.tvod_price))+"\n                        "),e("span",{staticClass:"toman-title"},[t._v("تومان")])])]),t._v(" "),e("div",{staticClass:"card-actions"},[e("button",{staticClass:"btn-delete",on:{click:function(e){return t.removeAddedItem(n.id)}}},[e("i",{staticClass:"fas fa-trash-alt",staticStyle:{color:"#ff6633","font-size":"1.5rem"}})])])])])}),0):t._e()]),t._v(" "),t.showAddMoreButton?e("div",{staticClass:"add-more-section"},[e("button",{staticClass:"btn-add-more",on:{click:function(e){return t.redirectToItem()}}},[e("i",{staticClass:"fas fa-plus"}),t._v("اضافه کردن قسمت های دیگر\n              ")])]):t._e(),t._v(" "),t.showPaymentMethods?e("div",{staticClass:"payment-section"},[e("div",{staticClass:"section-title"},[t._v("انتخاب روش پرداخت")]),t._v(" "),e("div",{staticClass:"payment-options"},t._l(t.paymentMethods,function(r){return e("div",{key:r.value,staticClass:"payment-option",class:{disabled:t.useWalletCredit}},[e("div",{staticClass:"payment-option-content"},[e("div",{staticClass:"payment-image"},[e("img",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],attrs:{"data-src":n(443)("./".concat(r.src))}})]),t._v(" "),e("div",{staticClass:"payment-info"},[e("div",{staticClass:"payment-name"},[t._v(t._s(r.name))])]),t._v(" "),e("div",{staticClass:"payment-radio"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.paymentMethod,expression:"paymentMethod"}],attrs:{id:"payment-".concat(r.value),type:"radio",name:"payment",disabled:t.useWalletCredit},domProps:{value:r.value,checked:t._q(t.paymentMethod,r.value)},on:{change:function(e){t.paymentMethod=r.value}}})])])])}),0)]):t._e(),t._v(" "),t.showWalletSection?e("div",{staticClass:"wallet-section"},[e("div",{staticClass:"d-flex justify-content-start align-content-center"},[e("i",{staticClass:"fas fa-wallet fa-2x",staticStyle:{color:"#525252",padding:"1rem"}}),t._v(" "),e("div",{staticClass:"wallet-option"},[e("label",{staticClass:"text-sm mb-0",staticStyle:{"font-weight":"600"},attrs:{for:"use-wallet"}},[t._v("کیف پول")]),t._v(" "),e("div",{staticClass:"wallet-balance"},[e("span",[t._v("موجودی :")]),t._v(" "),e("span",{staticClass:"balance-amount"},[t._v("\n                      "+t._s(t.my_credit)+"\n                    ")])])])]),t._v(" "),e("div",{staticClass:"custom-control custom-switch ml-2 mb-2",attrs:{dir:"rtl"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.useWalletCredit,expression:"useWalletCredit"}],staticClass:"custom-control-input",attrs:{id:"use-wallet",type:"checkbox",disabled:!t.hasEnoughWalletBalance},domProps:{checked:Array.isArray(t.useWalletCredit)?t._i(t.useWalletCredit,null)>-1:t.useWalletCredit},on:{change:function(e){var n=t.useWalletCredit,r=e.target,o=!!r.checked;if(Array.isArray(n)){var l=t._i(n,null);r.checked?l<0&&(t.useWalletCredit=n.concat([null])):l>-1&&(t.useWalletCredit=n.slice(0,l).concat(n.slice(l+1)))}else t.useWalletCredit=o}}}),t._v(" "),e("label",{staticClass:"custom-control-label",attrs:{for:"use-wallet"}})])]):t._e(),t._v(" "),t.showMobileInput?e("div",{staticClass:"mobile-section"},[e("div",{staticClass:"mobile-input-container"},[e("label",{attrs:{for:"mobile-input"}},[t._v("شماره موبایل")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.mobile,expression:"mobile"}],staticClass:"form-control",attrs:{id:"mobile-input",type:"tel",placeholder:"شماره موبایل خود را وارد کنید",dir:"rtl"},domProps:{value:t.mobile},on:{input:[function(e){e.target.composing||(t.mobile=e.target.value)},t.validateMobile]}}),t._v(" "),e("div",{staticClass:"input-note"},[t._v("\n                  برای خرید شماره تلفن خودرا وارد کنید\n                ")]),t._v(" "),t.mobileError?e("div",{staticClass:"error-message"},[t._v("\n                  "+t._s(t.mobileError)+"\n                ")]):t._e()])]):t._e(),t._v(" "),e("div",{staticClass:"price-summary"},[e("div",{staticClass:"price-row"},[e("span",[t._v("جمع")]),t._v(" "),e("span",{staticClass:"amount-value"},[t._v(t._s(t.formatPrice(t.subtotalAmount))+"\n                  "),e("span",{staticClass:"toman-title"},[t._v("تومان")])])]),t._v(" "),t.taxAmount>0?e("div",{staticClass:"price-row"},[e("span",[t._v("ارزش افزوده (۱۰٪)")]),t._v(" "),e("span",{staticClass:"amount-value"},[t._v(t._s(t.formatPrice(t.taxAmount))+"\n                  "),e("span",{staticClass:"toman-title"},[t._v("تومان")])])]):t._e()])])])]),t._v(" "),t.loading||t.error?t._e():e("div",{staticClass:"download-links-footer-simple"},[e("div",{staticClass:"footer-content"},[e("div",{staticClass:"payable-amount"},[e("span",{staticClass:"amount-label"},[t._v("مبلغ قابل پرداخت:")]),t._v(" "),e("span",{staticClass:"amount-value"},[t._v("\n              "+t._s(t.formatPrice(t.totalAmount))+"\n              "),e("span",{staticClass:"toman-title"},[t._v("تومان")])])]),t._v(" "),e("button",{staticClass:"btn btn-primary btn-payment",attrs:{disabled:!t.canPurchase||t.processing},on:{click:t.handlePurchase}},[t.processing?e("span",{staticClass:"spinner-border spinner-border-sm"}):e("span",[t._v("پرداخت")])])])])])])],1)},[],!1,null,"aad1fa38",null);e.default=component.exports},758:function(t,e,n){"use strict";var r=n(25),o=n(759),l=n(82),d=n(105),c=n(136),m=n(243);r({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=l(this),n=d(e),r=m(e,0);return r.length=o(r,e,e,n,0,void 0===t?1:c(t)),r}})},759:function(t,e,n){"use strict";var r=n(169),o=n(105),l=n(300),d=n(78),c=function(t,e,source,n,m,v,h,f){for(var element,y,_=m,C=0,w=!!h&&d(h,f);C<n;)C in source&&(element=w?w(source[C],C,e):source[C],v>0&&r(element)?(y=o(element),_=c(t,e,element,y,_,v-1)-1):(l(_+1),t[_]=element),_++),C++;return _};t.exports=c},760:function(t,e,n){"use strict";n(166)("flat")},761:function(t,e,n){"use strict";n(715)}}]);