(window.webpackJsonp=window.webpackJsonp||[]).push([[68,47],{712:function(t,e,r){"use strict";r.r(e);var n=r(41),o=(r(34),r(67),r(135),r(165),r(11),r(59),r(56),r(16),r(60),r(136),{name:"OptimizedImage",props:{imageSrc:{type:String,default:""},alt:{type:String,required:!0},width:{type:[String,Number],default:null},height:{type:[String,Number],default:null},thumbOptions:{type:Object,default:function(){return{w:null,h:null,q:100,a:"c",zc:null,src:""}}},type:{type:String,default:"posters",validator:function(t){return["posters","backdrops","casts","files","backstage","next"].includes(t)}},fluidGrow:{type:Boolean,default:!1},blank:{type:Boolean,default:!0},blankColor:{type:String,default:"#bbb"},show:{type:Boolean,default:!0},classNames:{type:String,default:""}},computed:{computedProps:function(){var t={blank:this.blank,blankColor:this.blankColor,show:this.show};return this.fluidGrow?t.fluidGrow=!0:this.width&&this.height&&(t.width=this.width,t.height="full"===this.height?"100%":this.height),t},computedSrc:function(){var t=new URLSearchParams;if(Object.entries(this.thumbOptions).forEach(function(e){var r=Object(n.a)(e,2),o=r[0],c=r[1];null!==c&&""!==c&&t.set(o,c)}),!t.get("src")){if(!this.imageSrc)return;t.set("src","https://cdn.upera.shop/s3/".concat(this.type,"/").concat(this.imageSrc))}return"backstage"===this.type||"next"===this.type?"https://thumb.upera.shop/thumb?w=382&h=220&q=100&a=t&src=https://cdn.upera.shop/s3/".concat(this.imageSrc):"https://thumb.upera.shop/thumb?"+t.toString()}}}),c=r(28),component=Object(c.a)(o,function(){var t=this,e=t._self._c;return e("div",[e("b-img",t._g(t._b({directives:[{name:"lazy-load",rawName:"v-lazy-load"}],class:"full"===t.height?"h-full":" "+t.classNames,attrs:{blank:"","blank-color":"#bbb",show:"",width:t.width,height:"full"===t.height?"600px":t.height,"data-src":t.computedSrc,alt:t.alt,rounded:"lg"}},"b-img",t.computedProps,!1),t.$listeners))],1)},[],!1,null,null,null);e.default=component.exports},722:function(t,e,r){"use strict";var n=r(25),o=r(147).findIndex,c=r(166),l="findIndex",d=!0;l in[]&&Array(1)[l](function(){d=!1}),n({target:"Array",proto:!0,forced:d},{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),c(l)},740:function(t,e,r){t.exports={}},790:function(t,e,r){"use strict";r(740)},808:function(t,e,r){"use strict";r.r(e);r(17),r(68),r(40);var n=r(23),o=r(3),c=r(69),l=(r(58),r(13),r(117),r(722),r(67),r(44),r(45),r(168),r(135),r(21),r(22),r(18),r(11),r(94),r(16),r(712));function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function h(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach(function(e){Object(o.a)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var f=[{value:"desc",label:"جدیدترین",icon:"fa fa-sort-numeric-desc ml-2"},{value:"asc",label:"قدیمی‌ترین",icon:"fa fa-sort-numeric-asc ml-2"}],m="seasonEpisodesSortOrder",v={name:"SeasonEpisodes",components:{OptimizedImage:l.default},props:{season:{type:Object,default:function(){return{}}},selectseriesid:{type:[String,Number],default:null},seasontitle:{type:String,default:""},type:{type:String,default:""},description:{type:String,default:""}},data:function(){return{showAll:!1,itemsPerRow:4,sortOrder:f[0].value,cartItemIds:[]}},computed:{sortOptions:function(){return f},currentSortOption:function(){var t=this;return this.sortOptions.find(function(option){return option.value===t.sortOrder})||this.sortOptions[0]},sortButtonIcon:function(){var t;return(null===(t=this.currentSortOption)||void 0===t?void 0:t.icon)||"fa fa-sort-alpha-down ml-2"},sortButtonLabel:function(){var t,label=null===(t=this.currentSortOption)||void 0===t?void 0:t.label;return label?"مرتب سازی · ".concat(label):"مرتب سازی"},isBasketActive:function(){var t;if(!this.$store)return!0;var e=null===(t=this.$store.state)||void 0===t?void 0:t.basketActive;return void 0===e||Boolean(e)},currentSeasonEpisodes:function(){if(!this.season||!this.selectseriesid)return[];var t=this.season[this.selectseriesid]||[],e=Object(c.a)(t);return"desc"===this.sortOrder&&e.reverse(),e},displayedEpisodes:function(){return this.showAll?this.currentSeasonEpisodes:this.currentSeasonEpisodes.slice(0,this.itemsPerRow)},hasMoreEpisodes:function(){return this.currentSeasonEpisodes.length>this.itemsPerRow}},watch:{isBasketActive:{immediate:!0,handler:function(t){t?(this.syncCartItems(),this.attachCartListener()):(this.cartItemIds=[],this.detachCartListener())}}},mounted:function(){this.loadSortPreference(),this.isBasketActive?(this.syncCartItems(),this.attachCartListener()):(this.cartItemIds=[],this.detachCartListener())},beforeDestroy:function(){this.detachCartListener()},methods:{ChooseLang:function(t,e){return e&&"fa"===this.$i18n.locale?e:t},toggleShowMore:function(){this.showAll=!this.showAll},setSortOrder:function(t){this.isValidSortOrder(t)&&this.sortOrder!==t&&(this.sortOrder=t,this.persistSortPreference(t))},loadSortPreference:function(){try{var t=localStorage.getItem(m);this.isValidSortOrder(t)&&(this.sortOrder=t)}catch(t){console.warn("Failed to load episode sort preference:",t)}},persistSortPreference:function(t){try{localStorage.setItem(m,t)}catch(t){console.warn("Failed to save episode sort preference:",t)}},isValidSortOrder:function(t){return this.sortOptions.some(function(option){return option.value===t})},getEpisodeSortTitle:function(t){var e;return t?"fa"===(null===(e=this.$i18n)||void 0===e?void 0:e.locale)?t.name_fa||t.name||"":t.name||t.name_fa||"":""},getMainButton:function(t){var e;return(null==t||null===(e=t.actions)||void 0===e?void 0:e.mainButton)||{exist:!1}},getMainButtonLabel:function(t){var e=this.getMainButton(t);if(!e.exist)return"";var r=e.label||{};return this.ChooseLang(r.en,r.fa)},getMainButtonAction:function(t){var e=this.getMainButton(t);return e.exist?e.action:""},getMainButtonIcon:function(t){var e=this.getMainButtonAction(t);return"buy"===e?"fa fa-shopping-cart mr-2":"subscription"===e?"fa fa-id-card mr-2":"fa fa-play mr-2"},isEpisodeInCart:function(t){if(!this.isBasketActive||!t)return!1;var e=String(t);return this.cartItemIds.includes(e)},updateCartState:function(t){t&&Array.isArray(t.content)?this.cartItemIds=t.content.map(function(t){return t&&null!=t.id?String(t.id):null}).filter(function(t){return null!==t}):this.cartItemIds=[]},syncCartItems:function(){if(this.isBasketActive)try{var t=localStorage.getItem("_cart");if(!t)return void(this.cartItemIds=[]);var e=JSON.parse(t);this.updateCartState(e)}catch(t){console.error("Failed to sync cart items:",t)}else this.cartItemIds=[]},emitCartChange:function(){try{var t=new StorageEvent("storage",{key:"_cart"});window.dispatchEvent(t)}catch(t){window.dispatchEvent(new Event("storage"))}this.$root.$emit("cart-updated")},attachCartListener:function(){var t=this;this.isBasketActive&&(this._cartStorageListener||(this._cartStorageListener=function(){return t.syncCartItems()},window.addEventListener("storage",this._cartStorageListener)))},detachCartListener:function(){this._cartStorageListener&&(window.removeEventListener("storage",this._cartStorageListener),this._cartStorageListener=null)},persistCartItem:function(t){try{var e=localStorage.getItem("_cart"),r=e?JSON.parse(e):{content:[],amount:0};Array.isArray(r.content)||(r.content=[]);var n=String(t.id),o=r.content.findIndex(function(t){return String(t.id)===n}),c=h(h({},t),{},{id:n});-1===o?r.content.push(c):r.content.splice(o,1,c),r.amount=r.content.reduce(function(t,e){return t+(e.tvod_price||0)},0),localStorage.setItem("_cart",JSON.stringify(r)),this.updateCartState(r),this.emitCartChange()}catch(t){console.error("Failed to persist cart item:",t)}},removeEpisodeFromCart:function(t){if(null!=t&&t.id)try{var e=localStorage.getItem("_cart"),r=e?JSON.parse(e):{content:[],amount:0};Array.isArray(r.content)||(r.content=[]);var n=String(t.id);r.content=r.content.filter(function(t){return String(null==t?void 0:t.id)!==n}),r.amount=r.content.reduce(function(t,e){return t+(e.tvod_price||0)},0),localStorage.setItem("_cart",JSON.stringify(r)),this.updateCartState(r),this.emitCartChange()}catch(t){console.error("Failed to remove episode from cart:",t)}},addEpisodeToCart:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark(function r(){var n,o,c,l,d,f,m,v;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=t&&t.id){r.next=1;break}return r.abrupt("return");case 1:return r.prev=1,c="/getV2/episode/".concat(t.id),r.next=2,e.$axios.get(c);case 2:if(l=r.sent,d=null==l?void 0:l.data,f=null,(f=null!=d&&null!==(n=d.data)&&void 0!==n&&n.episode?h(h({},d.data.episode),{},{cdn:d.data.cdn}):null!=d&&null!==(o=d.data)&&void 0!==o&&o.movie?h(h({},d.data.movie),{},{cdn:d.data.cdn}):null!=d&&d.data?d.data:d)&&f.id){r.next=3;break}return r.abrupt("return");case 3:m=h(h({},f),{},{id:String(f.id),type:f.type||"episode"}),e.persistCartItem(m),r.next=5;break;case 4:r.prev=4,v=r.catch(1),console.error("Failed to add episode to cart:",v);case 5:case"end":return r.stop()}},r,null,[[1,4]])}))()},handleAction:function(t,e){var r=this;return Object(n.a)(regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("play"!==e){n.next=1;break}r.$router.push({name:"episode-show-id",params:{id:t.id}}),n.next=4;break;case 1:if("buy"!==e){n.next=3;break}!1===(null===(o=r.$store)||void 0===o||null===(o=o.state)||void 0===o?void 0:o.basketActive)&&r.$store.dispatch("SET_BASKET_ACTIVE",!0);try{localStorage.setItem("_download_skip_main_item","1")}catch(t){console.error("Failed to set skip flag:",t)}return n.next=2,r.addEpisodeToCart(t);case 2:r.$store.dispatch("DOWNLOAD_MODAL_LOAD"),r.$emit("buy",t),n.next=4;break;case 3:"subscription"===e&&r.$emit("subscription",t);case 4:case"end":return n.stop()}},n)}))()}}},w=(r(790),r(28)),component=Object(w.a)(v,function(){var t=this,e=t._self._c;return e("section",{staticClass:"horizontal-list-container item mt-lg-2 pt-3",attrs:{id:"watching"}},[e("div",{staticClass:"container-fluid mb-3"},[e("div",{staticClass:"row align-items-center container-fluid-header"},[e("div",{staticClass:"col-6 col-md-auto"},[e("b-dropdown",{staticClass:"season-dropdown",attrs:{text:t.seasontitle,variant:"main",size:"md"}},t._l(t.season,function(r,n){return e("b-dropdown-item",{key:n,attrs:{href:"#",active:t.selectseriesid==n},on:{click:function(e){return e.preventDefault(),t.$emit("select-season",n)}}},[t._v("\n            فصل "+t._s(n)+"\n          ")])}),1)],1),t._v(" "),e("div",{staticClass:"col-6 col-md-auto"},[e("b-dropdown",{staticClass:"sort-dropdown",attrs:{variant:"text",size:"md",right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("i",{class:t.sortButtonIcon}),t._v("\n            "+t._s(t.sortButtonLabel)+"\n          ")]},proxy:!0}])},[t._v(" "),t._l(t.sortOptions,function(option){return e("b-dropdown-item",{key:option.value,attrs:{active:t.sortOrder===option.value},on:{click:function(e){return t.setSortOrder(option.value)}}},[e("i",{class:option.icon}),t._v("\n            "+t._s(option.label)+"\n          ")])})],2)],1)])]),t._v(" "),t.description?e("div",{staticClass:"container-fluid mb-4"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("p",{staticClass:"series-description text-light"},[t._v("\n          "+t._s(t.description)+"\n        ")])])])]):t._e(),t._v(" "),e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"row"},t._l(t.displayedEpisodes,function(r,n){return e("div",{key:n,staticClass:"col-lg-3 col-md-6 col-6 mb-3"},[e("div",{staticClass:"episode-card"},[e("nuxt-link",{staticClass:"episode-image-link",attrs:{to:{name:"episode-id",params:{id:r.id}}}},[e("div",{staticClass:"episode-image-wrapper"},[e("OptimizedImage",{staticClass:"episode-image",attrs:{"image-src":r.backdrop,alt:r.name,width:364,height:170,"thumb-options":{w:364,h:170,q:100,a:"t"},type:"backdrops","fluid-grow":""}}),t._v(" "),t.$auth.loggedIn&&r.current_time>0?e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-bar",style:"width: "+r.current_time/r.duration_time*100+"%",attrs:{role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"}})]):t._e()],1)]),t._v(" "),e("div",{staticClass:"episode-content"},[e("h6",{staticClass:"episode-title"},[t._v("\n              "+t._s(t.ChooseLang(r.name,r.name_fa))+"\n            ")]),t._v(" "),t.getMainButton(r).exist&&"buy"===t.getMainButtonAction(r)&&t.isEpisodeInCart(r.id)?e("button",{staticClass:"episode-remove-btn",on:{click:function(e){return t.removeEpisodeFromCart(r)}}},[t._v("\n              حذف از سبد\n              "),e("i",{staticClass:"fa fa-trash mr-2"})]):t.getMainButton(r).exist?e("button",{staticClass:"episode-play-btn",on:{click:function(e){t.handleAction(r,t.getMainButtonAction(r))}}},[t._v("\n              "+t._s(t.getMainButtonLabel(r))+"\n              "),e("i",{class:t.getMainButtonIcon(r)})]):e("nuxt-link",{staticClass:"episode-play-btn",attrs:{to:{name:"episode-id",params:{id:r.id}}}},[t._v("\n              تماشا\n              "),e("i",{staticClass:"fa fa-play mr-2"})])],1)],1)])}),0),t._v(" "),t.hasMoreEpisodes?e("div",{staticClass:"row mt-3 mb-5 mb-sm-4"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"show-more-container"},[e("div",{staticClass:"show-more-divider"}),t._v(" "),e("b-button",{staticClass:"show-more-btn",attrs:{variant:"outline-light"},on:{click:t.toggleShowMore}},[t._v("\n            "+t._s(t.showAll?"مشاهده کمتر":"مشاهده بیشتر")+"\n            "),e("i",{class:t.showAll?"fa fa-chevron-up":"fa fa-chevron-down"})]),t._v(" "),e("div",{staticClass:"show-more-divider"})],1)])]):t._e()])])},[],!1,null,"92b9f6d8",null);e.default=component.exports}}]);