(window.webpackJsonp=window.webpackJsonp||[]).push([[142],{1013:function(e,t,a){"use strict";a(876)},1080:function(e,t,a){"use strict";a.r(t);var s=a(27),i=(a(64),a(35),a(73),a(45),a(43),a(13),a(101),a(60),a(65),{components:{VideoPlayer:function(){return Promise.resolve().then(a.bind(null,750))}},beforeRouteLeave:function(e,t,a){if(this.$swal&&this.$swal.close)try{this.$swal.close()}catch(e){}a()},layout:"empty",data:function(){return{videoTitle:"",posterUrl:"",videoUrl:"",creditsData:{},tracks:[],loading:!0,guest:!0,soon:!1,recentlyTime:200,showNextVideo:!1,suggestion:null,suggestionBackdrop:"",startTime:0,fullrateData:null}},mounted:function(){this.$auth&&this.$auth.loggedIn&&(this.guest=!1),this.loadVideo(),window.addEventListener("popstate",this.handlePopState)},beforeDestroy:function(){if(this.$swal&&this.$swal.close)try{this.$swal.close()}catch(e){}window.removeEventListener("popstate",this.handlePopState)},methods:{handlePopState:function(){if(this.$swal&&this.$swal.close)try{this.$swal.close()}catch(e){}},showErrorAlert:function(e){var t=this,a="fa"===this.$i18n.locale?e.message_fa:e.message;a||(a=this.$t("player.error1"));var s={back:{text:this.$t("player.back"),value:"back",closeModal:!0,className:"swal-back"}};1===e.show_subscription&&(s.subscribe={text:this.$t("player.subscribe"),value:"subscribe",closeModal:!0}),this.$auth.loggedIn||1!==e.show_login||Object.assign(s,{login:{text:this.$t("nav.login"),value:"login",closeModal:!0}}),this.$swal({title:a,icon:"error",dangerMode:!0,buttons:s}).then(function(e){switch(e){case"back":default:window.history.length>2?t.$router.go(-1):t.$router.push({name:"video-id",params:{id:t.$route.params.id}});break;case"subscribe":t.$store.dispatch("subscription/SHOW_MODAL",{content_type:"video",content_id:t.$route.params.id});break;case"login":t.$store.dispatch("login/SHOW_MODAL",{premessage:null,premobile:null,preredirect:null,prerefresh:!1})}})},loadVideo:function(){var e=this;return Object(s.a)(regeneratorRuntime.mark(function t(){var a,s,i,r,o,n,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,a=e.$route.params.id){t.next=1;break}return t.abrupt("return");case 1:return s=e.$cookiz.get("ref")||"",i=e.guest?"/ghost/get/watch/video/".concat(a).concat(s?"?ref=".concat(s):""):"/get/watch/video/".concat(a).concat(s?"?ref=".concat(s):""),t.next=2,e.$axios.get(i);case 2:if(200!==(r=t.sent).status){t.next=4;break}return(o=r.data.data).fullrate_data&&(e.fullrateData=o.fullrate_data),e.creditsData={first_credits:o.first_credits||null,after_credits:o.after_credits||null,final_credits:o.final_credits||null},e.videoTitle="fa"===e.$i18n.locale&&o.video[0].name_fa?o.video[0].name_fa:o.video[0].name,e.posterUrl=o.cdn.lg_backdrop+o.video[0].backdrop,n=o.video[0].video.includes("?")?o.video[0].video+"&nosub=1":o.video[0].video+"?nosub=1",e.startTime=o.video[0].current_time||0,t.next=3,fetch(n,{method:"HEAD"});case 3:t.sent.ok?(e.videoUrl=n,e.soon=!1):e.soon=!0,o.new_subtitle&&Array.isArray(o.new_subtitle)&&(e.tracks=o.new_subtitle.map(function(e,t){return{kind:"captions",label:e.language,src:e.url,default:0===t}})),o.suggestion&&(e.suggestion=o.suggestion,e.suggestionBackdrop=o.cdn.md_backdrop+o.suggestion.backdrop),t.next=5;break;case 4:e.showErrorAlert(r.data.data);case 5:t.next=7;break;case 6:t.prev=6,l=t.catch(0),e.showErrorAlert(l.response.data);case 7:return t.prev=7,e.loading=!1,t.finish(7);case 8:case"end":return t.stop()}},t,null,[[0,6,7,8]])}))()},handlePlayerReady:function(e){this.startTime&&e.currentTime&&e.currentTime(this.startTime)},handleTimeUpdate:function(e){var t=e.currentTime,a=e.duration,s=e.player;if(Math.floor(t)>=this.recentlyTime){this.recentlyTime=Math.floor(t)+200;var i={current_time:Math.floor(t),duration_time:Math.floor(a),video_id:this.$route.params.id};this.guest?this.$axios.post("/ghost/create/watch/video/recently",i):this.$axios.post("/create/watch/video/recently",i)}return this.creditsData.final_credits&&t>=this.creditsData.final_credits&&this.suggestion||!this.creditsData.final_credits&&a-t<=100&&this.suggestion?this.showNextMovie=!0:this.showNextMovie=!1,s},handleEnded:function(){this.suggestion&&this.playNextVideo()},playNextVideo:function(){this.$router.push({name:"video-show-id",params:{id:this.suggestion.id}})},goBack:function(){window.history.length>2?this.$router.go(-1):this.$router.push({name:"video-id",params:{id:this.$route.params.id}})},handleSubscriptionPurchase:function(){}}}),r=(a(1013),a(32)),o=Object(r.a)(i,function(){var e=this,t=e._self._c;return t("div",{staticClass:"video-container"},[t("div",{staticClass:"hamshahri"},[t("a",{staticClass:"srmjs",on:{click:e.goBack}},[e._m(0)]),e._v(" "),e.loading?t("div",{staticClass:"video-loading-spinner"}):e._e(),e._v(" "),e.soon?t("p",{staticClass:"soon"},[e._v("به زودی...")]):e._e(),e._v(" "),e.soon?t("button",{staticClass:"btn btn-primary btn-lg fw-bold refresh-btn",on:{click:e.reloadPage}},[e._v("\n      بارگذاری مجدد\n    ")]):e._e()]),e._v(" "),t("div",{staticClass:"player-wrapper"},[e.videoUrl&&!e.loading?t("VideoPlayer",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],ref:"videoPlayer",staticClass:"full-screen-player vjs-fluid",attrs:{playerid:"video-player",stream:e.videoUrl,"data-poster":e.posterUrl,title:e.videoTitle,tracks:e.tracks,"player-auto-play":!0,"credits-data":e.creditsData,"fullrate-data":e.fullrateData,"content-id":e.$route.params.id,"content-type":"video"},on:{ready:e.handlePlayerReady,timeupdate:e.handleTimeUpdate,ended:e.handleEnded,"subscription-purchase":e.handleSubscriptionPurchase}}):e._e()],1),e._v(" "),e.showNextVideo&&e.suggestion?t("div",{staticClass:"next-video-overlay",on:{click:e.playNextVideo}},[t("div",{staticClass:"next-video-content"},[t("p",[e._v(e._s(e.$t("player.next"))+": "+e._s(e.suggestion.name_fa))]),e._v(" "),t("img",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],attrs:{"data-src":e.suggestionBackdrop,alt:"Next Video Backdrop"}})])]):e._e()])},[function(){var e=this._self._c;return e("div",{attrs:{id:"flowplayer-back-button"}},[e("div",{staticClass:"icon-back"})])}],!1,null,"725d92d4",null);t.default=o.exports;installComponents(o,{VideoPlayer:a(750).default})},876:function(e,t,a){e.exports={}}}]);