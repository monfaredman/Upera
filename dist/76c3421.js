(window.webpackJsonp=window.webpackJsonp||[]).push([[67,47],{761:function(t,e,r){"use strict";r.r(e);var n=r(41),o=(r(34),r(69),r(137),r(167),r(11),r(61),r(58),r(16),r(62),r(138),{name:"OptimizedImage",props:{imageSrc:{type:String,default:""},alt:{type:String,required:!0},width:{type:[String,Number],default:null},height:{type:[String,Number],default:null},thumbOptions:{type:Object,default:function(){return{w:null,h:null,q:100,a:"c",zc:null,src:""}}},type:{type:String,default:"posters",validator:function(t){return["posters","backdrops","casts","files","backstage","next"].includes(t)}},fluidGrow:{type:Boolean,default:!1},blank:{type:Boolean,default:!0},blankColor:{type:String,default:"#bbb"},show:{type:Boolean,default:!0},classNames:{type:String,default:""}},computed:{computedProps:function(){var t={blank:this.blank,blankColor:this.blankColor,show:this.show};return this.fluidGrow?t.fluidGrow=!0:this.width&&this.height&&(t.width=this.width,t.height="full"===this.height?"100%":this.height),t},computedSrc:function(){var t=new URLSearchParams;if(Object.entries(this.thumbOptions).forEach(function(e){var r=Object(n.a)(e,2),o=r[0],d=r[1];null!==d&&""!==d&&t.set(o,d)}),!t.get("src")){if(!this.imageSrc)return;t.set("src","https://cdn.upera.shop/s3/".concat(this.type,"/").concat(this.imageSrc))}return"backstage"===this.type||"next"===this.type?"https://thumb.upera.shop/thumb?w=382&h=220&q=100&a=t&src=https://cdn.upera.shop/s3/".concat(this.imageSrc):"https://thumb.upera.shop/thumb?"+t.toString()}}}),d=r(28),component=Object(d.a)(o,function(){var t=this,e=t._self._c;return e("div",[e("b-img",t._g(t._b({directives:[{name:"lazy-load",rawName:"v-lazy-load"}],class:"full"===t.height?"h-full":" "+t.classNames,attrs:{blank:"","blank-color":"#bbb",show:"",width:t.width,height:"full"===t.height?"600px":t.height,"data-src":t.computedSrc,alt:t.alt,rounded:"lg"}},"b-img",t.computedProps,!1),t.$listeners))],1)},[],!1,null,null,null);e.default=component.exports},771:function(t,e,r){"use strict";var n=r(25),o=r(149).findIndex,d=r(168),c="findIndex",l=!0;c in[]&&Array(1)[c](function(){l=!1}),n({target:"Array",proto:!0,forced:l},{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),d(c)},792:function(t,e,r){var content=r(857);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(57).default)("9d3a7596",content,!0,{sourceMap:!1})},856:function(t,e,r){"use strict";r(792)},857:function(t,e,r){var n=r(56)(function(i){return i[1]});n.push([t.i,"section#watching[data-v-92b9f6d8]{margin:-1rem 50px 0!important}.container-fluid[data-v-92b9f6d8]{padding:0!important}.col-lg-3.col-md-6.col-6.mb-3[data-v-92b9f6d8]{padding-right:0!important}.season-dropdown[data-v-92b9f6d8]{align-content:center;background:#ffece5!important;border-radius:8px;color:#f63;display:flex;height:44px;justify-content:center;opacity:1;text-align:center;width:326px}.season-dropdown[data-v-92b9f6d8] .btn{align-items:center;background:#ffece5!important;border:none;border-radius:8px;color:#f63;display:flex;gap:8px;height:100%;justify-content:center;padding:10px 24px;text-align:center;width:100%}.season-dropdown[data-v-92b9f6d8] .btn .caret,.season-dropdown[data-v-92b9f6d8] .btn .dropdown-toggle:after{margin-left:8px;margin-right:0}.sort-dropdown[data-v-92b9f6d8]{color:#f63!important;min-width:150px}.sort-dropdown[data-v-92b9f6d8] .dropdown-item{align-items:center;display:flex}.sort-dropdown[data-v-92b9f6d8] .dropdown-item i{font-size:.9rem}.sort-dropdown[data-v-92b9f6d8] .btn{align-items:center;color:#f63!important;display:flex}.series-description[data-v-92b9f6d8]{font-size:.95rem;line-height:1.6;opacity:.9}.show-more-container[data-v-92b9f6d8]{align-items:center;display:flex;justify-content:center;width:100%}.show-more-divider[data-v-92b9f6d8]{background-color:#000;flex:1;height:1px}.theme-dark .show-more-divider[data-v-92b9f6d8]{background-color:hsla(0,0%,100%,.2);flex:1;height:1px}.show-more-btn[data-v-92b9f6d8]{align-items:center!important;background:#fff;border:1px solid #f5f5f5;border-radius:16px!important;border-style:solid!important;border-width:1px!important;color:#525252!important;display:flex!important;flex-shrink:0!important;font-size:.8rem;font-weight:600;font-weight:500!important;gap:8px!important;height:44px!important;justify-content:center!important;opacity:1!important;padding:10px 24px!important;transition:all .3s ease!important;width:153px!important}.show-more-btn i[data-v-92b9f6d8]{font-size:.8rem;margin-right:4px}.show-more-btn[data-v-92b9f6d8]:hover{background-color:#303030;color:#fff!important;transform:translateY(-2px)}.theme-dark .show-more-btn[data-v-92b9f6d8]:hover{background-color:hsla(0,0%,100%,.1);color:#fff!important;transform:translateY(-2px)}.episode-card[data-v-92b9f6d8]{background:#373737;border-radius:8px;display:flex;flex-direction:column;gap:12px;opacity:1;padding:12px;transition:all .3s ease}.episode-card[data-v-92b9f6d8]:hover{box-shadow:0 4px 12px rgba(0,0,0,.3);transform:translateY(-4px)}.episode-image-link[data-v-92b9f6d8]{display:block;-webkit-text-decoration:none;text-decoration:none}.episode-image-wrapper[data-v-92b9f6d8]{background:linear-gradient(180deg,transparent 64.38%,#000 108.55%);border-radius:8px;overflow:hidden;position:relative}.episode-image[data-v-92b9f6d8]{border-radius:8px;height:100%;-o-object-fit:cover;object-fit:cover;width:100%}.episode-content[data-v-92b9f6d8]{display:flex;flex:1;flex-direction:column;gap:12px}.episode-title[data-v-92b9f6d8]{color:#fff;display:-webkit-box;font-size:18px;font-style:normal;font-weight:400;line-clamp:2;-webkit-line-clamp:2;line-height:32px;margin:0;overflow:hidden;text-align:right;text-overflow:ellipsis;-webkit-box-orient:vertical}.episode-play-btn[data-v-92b9f6d8]{background:#ffece5;color:#f63}.episode-play-btn[data-v-92b9f6d8],.episode-remove-btn[data-v-92b9f6d8]{align-items:center;border:none;border-radius:8px;cursor:pointer;display:flex;font-size:14px;font-weight:600;gap:4px;height:36px;justify-content:center;padding:8px 20px;-webkit-text-decoration:none;text-decoration:none;transition:all .3s ease;width:100%}.episode-remove-btn[data-v-92b9f6d8]{background:#ff4d4f;color:#fff}.episode-remove-btn[data-v-92b9f6d8]:hover{background:#ff3335;color:#fff}.episode-play-btn[data-v-92b9f6d8]:hover{background:#ffd9cc;color:#f63;-webkit-text-decoration:none;text-decoration:none}.episode-play-btn i[data-v-92b9f6d8]{font-size:12px;margin-left:4px}.progress[data-v-92b9f6d8]{background-color:hsla(0,0%,100%,.2)!important;border-radius:2px!important;bottom:8px!important;height:4px!important;left:8px!important;overflow:hidden!important;position:absolute;right:8px!important}.progress-bar[data-v-92b9f6d8]{background-color:#f63!important;height:100%!important;transition:width .3s ease!important}.btn[data-v-92b9f6d8]{align-items:center!important;display:block!important;gap:.45rem;justify-content:center!important}.col-auto[data-v-92b9f6d8]{margin:0 0 0 .5rem;padding:0!important}.season-dropdown[data-v-92b9f6d8] .btn,.sort-dropdown[data-v-92b9f6d8] .btn{align-items:center!important;display:flex!important;gap:.5rem;justify-content:center!important;text-align:center!important}.season-dropdown[data-v-92b9f6d8] .dropdown-toggle:after,.sort-dropdown[data-v-92b9f6d8] .dropdown-toggle:after{margin-left:6px;position:relative;top:1px;vertical-align:middle}@media (max-width:767.98px){.season-dropdown[data-v-92b9f6d8]{width:-moz-fit-content;width:fit-content}}@media (max-width:575.98px){section#watching[data-v-92b9f6d8]{margin-bottom:1rem!important;margin-left:unset!important;margin-right:unset!important;margin-top:-1rem!important}.episode-title[data-v-92b9f6d8]{color:#fff;display:-webkit-box;font-size:14px;font-style:normal;font-weight:400;line-clamp:2;-webkit-line-clamp:2;line-height:32px;margin:0;overflow:hidden;text-align:right;text-overflow:ellipsis;-webkit-box-orient:vertical}.episode-card[data-v-92b9f6d8]{background:#373737;border-radius:8px;display:flex;flex-direction:column;gap:8px;opacity:1;padding:0;transition:all .3s ease}.episode-content[data-v-92b9f6d8]{gap:2px}.sort-dropdown[data-v-92b9f6d8]{min-width:100px;padding:0;width:100px}.container-fluid-header .col-6[data-v-92b9f6d8]{padding:0!important}}",""]),n.locals={},t.exports=n},888:function(t,e,r){"use strict";r.r(e);r(17),r(70),r(40);var n=r(23),o=r(3),d=r(71),c=(r(60),r(13),r(119),r(771),r(69),r(44),r(45),r(170),r(137),r(21),r(22),r(18),r(11),r(96),r(16),r(761));function l(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function f(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?l(Object(r),!0).forEach(function(e){Object(o.a)(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var h=[{value:"desc",label:"جدیدترین",icon:"fa fa-sort-numeric-desc ml-2"},{value:"asc",label:"قدیمی‌ترین",icon:"fa fa-sort-numeric-asc ml-2"}],m="seasonEpisodesSortOrder",v={name:"SeasonEpisodes",components:{OptimizedImage:c.default},props:{season:{type:Object,default:function(){return{}}},selectseriesid:{type:[String,Number],default:null},seasontitle:{type:String,default:""},type:{type:String,default:""},description:{type:String,default:""}},data:function(){return{showAll:!1,itemsPerRow:4,sortOrder:h[0].value,cartItemIds:[]}},computed:{sortOptions:function(){return h},currentSortOption:function(){var t=this;return this.sortOptions.find(function(option){return option.value===t.sortOrder})||this.sortOptions[0]},sortButtonIcon:function(){var t;return(null===(t=this.currentSortOption)||void 0===t?void 0:t.icon)||"fa fa-sort-alpha-down ml-2"},sortButtonLabel:function(){var t,label=null===(t=this.currentSortOption)||void 0===t?void 0:t.label;return label?"مرتب سازی · ".concat(label):"مرتب سازی"},isBasketActive:function(){var t;if(!this.$store)return!0;var e=null===(t=this.$store.state)||void 0===t?void 0:t.basketActive;return void 0===e||Boolean(e)},currentSeasonEpisodes:function(){if(!this.season||!this.selectseriesid)return[];var t=this.season[this.selectseriesid]||[],e=Object(d.a)(t);return"desc"===this.sortOrder&&e.reverse(),e},displayedEpisodes:function(){return this.showAll?this.currentSeasonEpisodes:this.currentSeasonEpisodes.slice(0,this.itemsPerRow)},hasMoreEpisodes:function(){return this.currentSeasonEpisodes.length>this.itemsPerRow}},watch:{isBasketActive:{immediate:!0,handler:function(t){t?(this.syncCartItems(),this.attachCartListener()):(this.cartItemIds=[],this.detachCartListener())}}},mounted:function(){this.loadSortPreference(),this.isBasketActive?(this.syncCartItems(),this.attachCartListener()):(this.cartItemIds=[],this.detachCartListener())},beforeDestroy:function(){this.detachCartListener()},methods:{ChooseLang:function(t,e){return e&&"fa"===this.$i18n.locale?e:t},toggleShowMore:function(){this.showAll=!this.showAll},setSortOrder:function(t){this.isValidSortOrder(t)&&this.sortOrder!==t&&(this.sortOrder=t,this.persistSortPreference(t))},loadSortPreference:function(){try{var t=localStorage.getItem(m);this.isValidSortOrder(t)&&(this.sortOrder=t)}catch(t){console.warn("Failed to load episode sort preference:",t)}},persistSortPreference:function(t){try{localStorage.setItem(m,t)}catch(t){console.warn("Failed to save episode sort preference:",t)}},isValidSortOrder:function(t){return this.sortOptions.some(function(option){return option.value===t})},getEpisodeSortTitle:function(t){var e;return t?"fa"===(null===(e=this.$i18n)||void 0===e?void 0:e.locale)?t.name_fa||t.name||"":t.name||t.name_fa||"":""},getMainButton:function(t){var e;return(null==t||null===(e=t.actions)||void 0===e?void 0:e.mainButton)||{exist:!1}},getMainButtonLabel:function(t){var e=this.getMainButton(t);if(!e.exist)return"";var r=e.label||{};return this.ChooseLang(r.en,r.fa)},getMainButtonAction:function(t){var e=this.getMainButton(t);return e.exist?e.action:""},getMainButtonIcon:function(t){var e=this.getMainButtonAction(t);return"buy"===e?"fa fa-shopping-cart mr-2":"subscription"===e?"fa fa-id-card mr-2":"fa fa-play mr-2"},isEpisodeInCart:function(t){if(!this.isBasketActive||!t)return!1;var e=String(t);return this.cartItemIds.includes(e)},updateCartState:function(t){t&&Array.isArray(t.content)?this.cartItemIds=t.content.map(function(t){return t&&null!=t.id?String(t.id):null}).filter(function(t){return null!==t}):this.cartItemIds=[]},syncCartItems:function(){if(this.isBasketActive)try{var t=localStorage.getItem("_cart");if(!t)return void(this.cartItemIds=[]);var e=JSON.parse(t);this.updateCartState(e)}catch(t){console.error("Failed to sync cart items:",t)}else this.cartItemIds=[]},emitCartChange:function(){try{var t=new StorageEvent("storage",{key:"_cart"});window.dispatchEvent(t)}catch(t){window.dispatchEvent(new Event("storage"))}this.$root.$emit("cart-updated")},attachCartListener:function(){var t=this;this.isBasketActive&&(this._cartStorageListener||(this._cartStorageListener=function(){return t.syncCartItems()},window.addEventListener("storage",this._cartStorageListener)))},detachCartListener:function(){this._cartStorageListener&&(window.removeEventListener("storage",this._cartStorageListener),this._cartStorageListener=null)},persistCartItem:function(t){try{var e=localStorage.getItem("_cart"),r=e?JSON.parse(e):{content:[],amount:0};Array.isArray(r.content)||(r.content=[]);var n=String(t.id),o=r.content.findIndex(function(t){return String(t.id)===n}),d=f(f({},t),{},{id:n});-1===o?r.content.push(d):r.content.splice(o,1,d),r.amount=r.content.reduce(function(t,e){return t+(e.tvod_price||0)},0),localStorage.setItem("_cart",JSON.stringify(r)),this.updateCartState(r),this.emitCartChange()}catch(t){console.error("Failed to persist cart item:",t)}},removeEpisodeFromCart:function(t){if(null!=t&&t.id)try{var e=localStorage.getItem("_cart"),r=e?JSON.parse(e):{content:[],amount:0};Array.isArray(r.content)||(r.content=[]);var n=String(t.id);r.content=r.content.filter(function(t){return String(null==t?void 0:t.id)!==n}),r.amount=r.content.reduce(function(t,e){return t+(e.tvod_price||0)},0),localStorage.setItem("_cart",JSON.stringify(r)),this.updateCartState(r),this.emitCartChange()}catch(t){console.error("Failed to remove episode from cart:",t)}},addEpisodeToCart:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark(function r(){var n,o,d,c,l,h,m,v;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=t&&t.id){r.next=1;break}return r.abrupt("return");case 1:return r.prev=1,d="/getV2/episode/".concat(t.id),r.next=2,e.$axios.get(d);case 2:if(c=r.sent,l=null==c?void 0:c.data,h=null,(h=null!=l&&null!==(n=l.data)&&void 0!==n&&n.episode?f(f({},l.data.episode),{},{cdn:l.data.cdn}):null!=l&&null!==(o=l.data)&&void 0!==o&&o.movie?f(f({},l.data.movie),{},{cdn:l.data.cdn}):null!=l&&l.data?l.data:l)&&h.id){r.next=3;break}return r.abrupt("return");case 3:m=f(f({},h),{},{id:String(h.id),type:h.type||"episode"}),e.persistCartItem(m),r.next=5;break;case 4:r.prev=4,v=r.catch(1),console.error("Failed to add episode to cart:",v);case 5:case"end":return r.stop()}},r,null,[[1,4]])}))()},handleAction:function(t,e){var r=this;return Object(n.a)(regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("play"!==e){n.next=1;break}r.$router.push({name:"episode-show-id",params:{id:t.id}}),n.next=4;break;case 1:if("buy"!==e){n.next=3;break}!1===(null===(o=r.$store)||void 0===o||null===(o=o.state)||void 0===o?void 0:o.basketActive)&&r.$store.dispatch("SET_BASKET_ACTIVE",!0);try{localStorage.setItem("_download_skip_main_item","1")}catch(t){console.error("Failed to set skip flag:",t)}return n.next=2,r.addEpisodeToCart(t);case 2:r.$store.dispatch("DOWNLOAD_MODAL_LOAD"),r.$emit("buy",t),n.next=4;break;case 3:"subscription"===e&&r.$emit("subscription",t);case 4:case"end":return n.stop()}},n)}))()}}},w=(r(856),r(28)),component=Object(w.a)(v,function(){var t=this,e=t._self._c;return e("section",{staticClass:"horizontal-list-container item mt-lg-2 pt-3",attrs:{id:"watching"}},[e("div",{staticClass:"container-fluid mb-3"},[e("div",{staticClass:"row align-items-center container-fluid-header"},[e("div",{staticClass:"col-6 col-md-auto"},[e("b-dropdown",{staticClass:"season-dropdown",attrs:{text:t.seasontitle,variant:"main",size:"md"}},t._l(t.season,function(r,n){return e("b-dropdown-item",{key:n,attrs:{href:"#",active:t.selectseriesid==n},on:{click:function(e){return e.preventDefault(),t.$emit("select-season",n)}}},[t._v("\n            فصل "+t._s(n)+"\n          ")])}),1)],1),t._v(" "),e("div",{staticClass:"col-6 col-md-auto"},[e("b-dropdown",{staticClass:"sort-dropdown",attrs:{variant:"text",size:"md",right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("i",{class:t.sortButtonIcon}),t._v("\n            "+t._s(t.sortButtonLabel)+"\n          ")]},proxy:!0}])},[t._v(" "),t._l(t.sortOptions,function(option){return e("b-dropdown-item",{key:option.value,attrs:{active:t.sortOrder===option.value},on:{click:function(e){return t.setSortOrder(option.value)}}},[e("i",{class:option.icon}),t._v("\n            "+t._s(option.label)+"\n          ")])})],2)],1)])]),t._v(" "),t.description?e("div",{staticClass:"container-fluid mb-4"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("p",{staticClass:"series-description text-light"},[t._v("\n          "+t._s(t.description)+"\n        ")])])])]):t._e(),t._v(" "),e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"row"},t._l(t.displayedEpisodes,function(r,n){return e("div",{key:n,staticClass:"col-lg-3 col-md-6 col-6 mb-3"},[e("div",{staticClass:"episode-card"},[e("nuxt-link",{staticClass:"episode-image-link",attrs:{to:{name:"episode-id",params:{id:r.id}}}},[e("div",{staticClass:"episode-image-wrapper"},[e("OptimizedImage",{staticClass:"episode-image",attrs:{"image-src":r.backdrop,alt:r.name,width:364,height:170,"thumb-options":{w:364,h:170,q:100,a:"t"},type:"backdrops","fluid-grow":""}}),t._v(" "),t.$auth.loggedIn&&r.current_time>0?e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-bar",style:"width: "+r.current_time/r.duration_time*100+"%",attrs:{role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"}})]):t._e()],1)]),t._v(" "),e("div",{staticClass:"episode-content"},[e("h6",{staticClass:"episode-title"},[t._v("\n              "+t._s(t.ChooseLang(r.name,r.name_fa))+"\n            ")]),t._v(" "),t.getMainButton(r).exist&&"buy"===t.getMainButtonAction(r)&&t.isEpisodeInCart(r.id)?e("button",{staticClass:"episode-remove-btn",on:{click:function(e){return t.removeEpisodeFromCart(r)}}},[t._v("\n              حذف از سبد\n              "),e("i",{staticClass:"fa fa-trash mr-2"})]):t.getMainButton(r).exist?e("button",{staticClass:"episode-play-btn",on:{click:function(e){t.handleAction(r,t.getMainButtonAction(r))}}},[t._v("\n              "+t._s(t.getMainButtonLabel(r))+"\n              "),e("i",{class:t.getMainButtonIcon(r)})]):e("nuxt-link",{staticClass:"episode-play-btn",attrs:{to:{name:"episode-id",params:{id:r.id}}}},[t._v("\n              تماشا\n              "),e("i",{staticClass:"fa fa-play mr-2"})])],1)],1)])}),0),t._v(" "),t.hasMoreEpisodes?e("div",{staticClass:"row mt-3 mb-5 mb-sm-4"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"show-more-container"},[e("div",{staticClass:"show-more-divider"}),t._v(" "),e("b-button",{staticClass:"show-more-btn",attrs:{variant:"outline-light"},on:{click:t.toggleShowMore}},[t._v("\n            "+t._s(t.showAll?"مشاهده کمتر":"مشاهده بیشتر")+"\n            "),e("i",{class:t.showAll?"fa fa-chevron-up":"fa fa-chevron-down"})]),t._v(" "),e("div",{staticClass:"show-more-divider"})],1)])]):t._e()])])},[],!1,null,"92b9f6d8",null);e.default=component.exports}}]);