(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{1041:function(e,t,r){"use strict";r.r(t);var o=r(23),n=(r(59),r(32),r(67),r(45),r(40),r(11),r(94),{components:{VideoPlayer:r(716).default},beforeRouteLeave:function(e,t,r){if(this.$swal&&this.$swal.close)try{this.$swal.close()}catch(e){}r()},layout:"empty",data:function(){return{videoTitle:"",posterUrl:"",videoUrl:"",creditsData:{},tracks:[],loading:!0,guest:!0,soon:!1,recentlyTime:200,showNextVideo:!1,suggestion:null,suggestionBackdrop:"",startTime:0,fullrateData:null}},mounted:function(){this.$auth&&this.$auth.loggedIn&&(this.guest=!1),this.loadVideo(),window.addEventListener("popstate",this.handlePopState)},beforeDestroy:function(){if(this.$swal&&this.$swal.close)try{this.$swal.close()}catch(e){}window.removeEventListener("popstate",this.handlePopState)},methods:{handlePopState:function(){if(this.$swal&&this.$swal.close)try{this.$swal.close()}catch(e){}},showErrorAlert:function(data){var e=this,t="fa"===this.$i18n.locale?data.message_fa:data.message;t||(t=this.$t("player.error1"));var r={back:{text:this.$t("player.back"),value:"back",closeModal:!0,className:"swal-back"}};1===data.show_subscription&&(r.subscribe={text:this.$t("player.subscribe"),value:"subscribe",closeModal:!0}),this.$auth.loggedIn||1!==data.show_login||Object.assign(r,{login:{text:this.$t("nav.login"),value:"login",closeModal:!0}}),this.$swal({title:t,icon:"error",dangerMode:!0,buttons:r}).then(function(t){switch(t){case"back":default:window.history.length>2?e.$router.go(-1):e.$router.push({name:"video-id",params:{id:e.$route.params.id}});break;case"subscribe":e.$store.dispatch("subscription/SHOW_MODAL",{content_type:"video",content_id:e.$route.params.id});break;case"login":e.$store.dispatch("login/SHOW_MODAL",{premessage:null,premobile:null,preredirect:null,prerefresh:!1})}})},loadVideo:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark(function t(){var r,o,n,l,data,c,d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=e.$route.params.id){t.next=1;break}return t.abrupt("return");case 1:return o=e.$cookiz.get("ref")||"",n=e.guest?"/ghost/get/watch/video/".concat(r).concat(o?"?ref=".concat(o):""):"/get/watch/video/".concat(r).concat(o?"?ref=".concat(o):""),t.next=2,e.$axios.get(n);case 2:if(200!==(l=t.sent).status){t.next=4;break}return(data=l.data.data).fullrate_data&&(e.fullrateData=data.fullrate_data),e.creditsData={first_credits:data.first_credits||null,after_credits:data.after_credits||null,final_credits:data.final_credits||null},e.videoTitle="fa"===e.$i18n.locale&&data.video[0].name_fa?data.video[0].name_fa:data.video[0].name,e.posterUrl=data.cdn.lg_backdrop+data.video[0].backdrop,c=data.video[0].video.includes("?")?data.video[0].video+"&nosub=1":data.video[0].video+"?nosub=1",e.startTime=data.video[0].current_time||0,t.next=3,fetch(c,{method:"HEAD"});case 3:t.sent.ok?(e.videoUrl=c,e.soon=!1):e.soon=!0,data.new_subtitle&&Array.isArray(data.new_subtitle)&&(e.tracks=data.new_subtitle.map(function(track,e){return{kind:"captions",label:track.language,src:track.url,default:0===e}})),data.suggestion&&(e.suggestion=data.suggestion,e.suggestionBackdrop=data.cdn.md_backdrop+data.suggestion.backdrop),t.next=5;break;case 4:e.showErrorAlert(l.data.data);case 5:t.next=7;break;case 6:t.prev=6,d=t.catch(0),e.showErrorAlert(d.response.data);case 7:return t.prev=7,e.loading=!1,t.finish(7);case 8:case"end":return t.stop()}},t,null,[[0,6,7,8]])}))()},handlePlayerReady:function(e){this.startTime&&e.currentTime&&e.currentTime(this.startTime)},handleTimeUpdate:function(e){var t=e.currentTime,r=e.duration,o=e.player;if(Math.floor(t)>=this.recentlyTime){this.recentlyTime=Math.floor(t)+200;var n={current_time:Math.floor(t),duration_time:Math.floor(r),video_id:this.$route.params.id};this.guest?this.$axios.post("/ghost/create/watch/video/recently",n):this.$axios.post("/create/watch/video/recently",n)}return this.creditsData.final_credits&&t>=this.creditsData.final_credits&&this.suggestion||!this.creditsData.final_credits&&r-t<=100&&this.suggestion?this.showNextMovie=!0:this.showNextMovie=!1,o},handleEnded:function(){this.suggestion&&this.playNextVideo()},playNextVideo:function(){this.$router.push({name:"video-show-id",params:{id:this.suggestion.id}})},goBack:function(){window.history.length>2?this.$router.go(-1):this.$router.push({name:"video-id",params:{id:this.$route.params.id}})},handleSubscriptionPurchase:function(){console.log("Subscription purchase triggered from video player")}}}),l=(r(987),r(28)),component=Object(l.a)(n,function(){var e=this,t=e._self._c;return t("div",{staticClass:"video-container"},[t("div",{staticClass:"hamshahri"},[t("a",{staticClass:"srmjs",on:{click:e.goBack}},[e._m(0)]),e._v(" "),e.loading?t("div",{staticClass:"video-loading-spinner"}):e._e(),e._v(" "),e.soon?t("p",{staticClass:"soon"},[e._v("به زودی...")]):e._e(),e._v(" "),e.soon?t("button",{staticClass:"btn btn-primary btn-lg fw-bold refresh-btn",on:{click:e.reloadPage}},[e._v("\n      بارگذاری مجدد\n    ")]):e._e()]),e._v(" "),t("div",{staticClass:"player-wrapper"},[e.videoUrl&&!e.loading?t("VideoPlayer",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],ref:"videoPlayer",staticClass:"full-screen-player vjs-fluid",attrs:{playerid:"video-player",stream:e.videoUrl,"data-poster":e.posterUrl,title:e.videoTitle,tracks:e.tracks,"player-auto-play":!0,"credits-data":e.creditsData,"fullrate-data":e.fullrateData,"content-id":e.$route.params.id,"content-type":"video"},on:{ready:e.handlePlayerReady,timeupdate:e.handleTimeUpdate,ended:e.handleEnded,"subscription-purchase":e.handleSubscriptionPurchase}}):e._e()],1),e._v(" "),e.showNextVideo&&e.suggestion?t("div",{staticClass:"next-video-overlay",on:{click:e.playNextVideo}},[t("div",{staticClass:"next-video-content"},[t("p",[e._v(e._s(e.$t("player.next"))+": "+e._s(e.suggestion.name_fa))]),e._v(" "),t("img",{directives:[{name:"lazy-load",rawName:"v-lazy-load"}],attrs:{"data-src":e.suggestionBackdrop,alt:"Next Video Backdrop"}})])]):e._e()])},[function(){var e=this._self._c;return e("div",{attrs:{id:"flowplayer-back-button"}},[e("div",{staticClass:"icon-back"})])}],!1,null,"2b9d1007",null);t.default=component.exports;installComponents(component,{VideoPlayer:r(716).default})},906:function(e,t,r){e.exports={}},987:function(e,t,r){"use strict";r(906)}}]);