(window.webpackJsonp=window.webpackJsonp||[]).push([[22,59],{1032:function(t,e,i){"use strict";i(895)},1110:function(t,e,i){"use strict";i.r(e);i(21),i(72),i(43);var n=i(27),s=i(3),r=i(74),a=(i(64),i(15),i(125),i(471),i(73),i(45),i(49),i(195),i(142),i(25),i(26),i(22),i(13),i(101),i(19),i(97),i(741));function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach(function(e){Object(s.a)(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var u=[{value:"desc",label:"جدیدترین",icon:"fa fa-sort-numeric-desc ml-2"},{value:"asc",label:"قدیمی‌ترین",icon:"fa fa-sort-numeric-asc ml-2"}],l="seasonEpisodesSortOrder",d={name:"SeasonEpisodes",components:{OptimizedImage:a.default},props:{season:{type:Object,default:function(){return{}}},selectseriesid:{type:[String,Number],default:null},seasontitle:{type:String,default:""},type:{type:String,default:""},description:{type:String,default:""}},data:function(){return{showAll:!1,itemsPerRow:4,sortOrder:u[0].value,cartItemIds:[],isUpdatingCart:!1}},computed:{sortOptions:function(){return u},currentSortOption:function(){var t=this;return this.sortOptions.find(function(e){return e.value===t.sortOrder})||this.sortOptions[0]},sortButtonIcon:function(){var t;return(null===(t=this.currentSortOption)||void 0===t?void 0:t.icon)||"fa fa-sort-alpha-down ml-2"},sortButtonLabel:function(){var t,e=null===(t=this.currentSortOption)||void 0===t?void 0:t.label;return e?"مرتب سازی · ".concat(e):"مرتب سازی"},isBasketActive:function(){var t;if(!this.$store)return!0;var e=null===(t=this.$store.state)||void 0===t?void 0:t.basketActive;return void 0===e||Boolean(e)},currentSeasonEpisodes:function(){if(!this.season||!this.selectseriesid)return[];var t=this.season[this.selectseriesid]||[],e=Object(r.a)(t);return"desc"===this.sortOrder&&e.reverse(),e},displayedEpisodes:function(){return this.showAll?this.currentSeasonEpisodes:this.currentSeasonEpisodes.slice(0,this.itemsPerRow)},hasMoreEpisodes:function(){return this.currentSeasonEpisodes.length>this.itemsPerRow}},watch:{isBasketActive:{immediate:!0,handler:function(t){t?(this.syncCartItems(),this.attachCartListener()):(this.cartItemIds=[],this.detachCartListener())}}},mounted:function(){this.loadSortPreference(),this.isBasketActive?(this.syncCartItems(),this.attachCartListener()):(this.cartItemIds=[],this.detachCartListener())},beforeDestroy:function(){this.detachCartListener()},methods:{ChooseLang:function(t,e){return e&&"fa"===this.$i18n.locale?e:t},toggleShowMore:function(){this.showAll=!this.showAll},setSortOrder:function(t){this.isValidSortOrder(t)&&this.sortOrder!==t&&(this.sortOrder=t,this.persistSortPreference(t))},loadSortPreference:function(){try{var t=localStorage.getItem(l);this.isValidSortOrder(t)&&(this.sortOrder=t)}catch(t){}},persistSortPreference:function(t){try{localStorage.setItem(l,t)}catch(t){}},isValidSortOrder:function(t){return this.sortOptions.some(function(e){return e.value===t})},getEpisodeSortTitle:function(t){var e;return t?"fa"===(null===(e=this.$i18n)||void 0===e?void 0:e.locale)?t.name_fa||t.name||"":t.name||t.name_fa||"":""},getMainButton:function(t){var e;return(null==t||null===(e=t.actions)||void 0===e?void 0:e.mainButton)||{exist:!1}},getMainButtonLabel:function(t){var e=this.getMainButton(t);if(!e.exist)return"";var i=e.label||{};return this.ChooseLang(i.en,i.fa)},getMainButtonAction:function(t){var e=this.getMainButton(t);return e.exist?e.action:""},getMainButtonIcon:function(t){var e=this.getMainButtonAction(t);return"buy"===e?"fa fa-shopping-cart mr-2":"subscription"===e?"fa fa-id-card mr-2":"fa fa-play mr-2"},isEpisodeInCart:function(t){if(!this.isBasketActive||!t)return!1;var e=String(t);return this.cartItemIds.includes(e)},updateCartState:function(t){t&&Array.isArray(t.content)?this.cartItemIds=t.content.map(function(t){return t&&null!=t.id?String(t.id):null}).filter(function(t){return null!==t}):this.cartItemIds=[]},syncCartItems:function(){if(this.isBasketActive)try{var t=localStorage.getItem("_cart");if(!t)return void(this.cartItemIds=[]);var e=JSON.parse(t);this.updateCartState(e)}catch(t){}else this.cartItemIds=[]},emitCartChange:function(){var t=this;this.isUpdatingCart=!0;try{this.$root.$emit("cart-updated")}finally{setTimeout(function(){t.isUpdatingCart=!1},100)}},attachCartListener:function(){var t=this;this.isBasketActive&&(this._cartStorageListener||(this._cartStorageListener=function(e){!t.isUpdatingCart&&e&&"_cart"===e.key&&void 0!==e.newValue&&t.syncCartItems()},window.addEventListener("storage",this._cartStorageListener),this.$root.$on("cart-updated",this.syncCartItems)))},detachCartListener:function(){this._cartStorageListener&&(window.removeEventListener("storage",this._cartStorageListener),this._cartStorageListener=null),this.$root.$off("cart-updated",this.syncCartItems)},persistCartItem:function(t){var e=this;try{var i=localStorage.getItem("_cart"),n=i?JSON.parse(i):{content:[],amount:0};Array.isArray(n.content)||(n.content=[]);var s=String(t.id),r=n.content.findIndex(function(t){return String(t.id)===s}),a=c(c({},t),{},{id:s});-1===r?n.content.push(a):n.content.splice(r,1,a),n.amount=n.content.reduce(function(t,e){return t+(e.tvod_price||0)},0),localStorage.setItem("_cart",JSON.stringify(n)),this.updateCartState(n),this.$nextTick(function(){e.emitCartChange()})}catch(t){}},removeEpisodeFromCart:function(t){var e=this;if(null!=t&&t.id)try{var i=localStorage.getItem("_cart"),n=i?JSON.parse(i):{content:[],amount:0};Array.isArray(n.content)||(n.content=[]);var s=String(t.id);n.content=n.content.filter(function(t){return String(null==t?void 0:t.id)!==s}),n.amount=n.content.reduce(function(t,e){return t+(e.tvod_price||0)},0),localStorage.setItem("_cart",JSON.stringify(n)),this.updateCartState(n),this.$nextTick(function(){e.emitCartChange()})}catch(t){}},addEpisodeToCart:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark(function i(){var n,s,r,a,o,u,l;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(null!=t&&t.id){i.next=1;break}return i.abrupt("return");case 1:return i.prev=1,r="/getV2/episode/".concat(t.id),i.next=2,e.$axios.get(r);case 2:if(a=i.sent,o=null==a?void 0:a.data,u=null,(u=null!=o&&null!==(n=o.data)&&void 0!==n&&n.episode?c(c({},o.data.episode),{},{cdn:o.data.cdn}):null!=o&&null!==(s=o.data)&&void 0!==s&&s.movie?c(c({},o.data.movie),{},{cdn:o.data.cdn}):null!=o&&o.data?o.data:o)&&u.id){i.next=3;break}return i.abrupt("return");case 3:l=c(c({},u),{},{id:String(u.id),type:u.type||"episode"}),e.persistCartItem(l),e.isBasketActive&&e.cartItemIds.length>1&&e.showAddedToBasketToast(),i.next=5;break;case 4:i.prev=4,i.catch(1);case 5:case"end":return i.stop()}},i,null,[[1,4]])}))()},showAddedToBasketToast:function(){var t=this;this.$swal({title:"به سبد خرید اضافه شد",icon:"success",buttons:{basket:{text:"مشاهده سبد خرید",value:"basket",className:"swal-button--confirm"},close:{text:"بستن",value:"close",className:"swal-button--cancel"}},timer:4e3}).then(function(e){"basket"===e&&(window.innerWidth<768?t.$emit("buyItem"):(t.$root.$emit("show-basket"),t.$store.dispatch("DOWNLOAD_MODAL_LOAD")))})},handleAction:function(t,e){var i=this;return Object(n.a)(regeneratorRuntime.mark(function n(){var s,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("play"!==e){n.next=1;break}i.$router.push({name:"episode-show-id",params:{id:t.id}}),n.next=4;break;case 1:if("buy"!==e){n.next=3;break}!1===(null===(s=i.$store)||void 0===s||null===(s=s.state)||void 0===s?void 0:s.basketActive)&&i.$store.dispatch("SET_BASKET_ACTIVE",!0),r=0===i.cartItemIds.length;try{localStorage.setItem("_download_skip_main_item","1")}catch(t){}return n.next=2,i.addEpisodeToCart(t);case 2:r&&i.$emit("show-download-modal",t),i.$store.dispatch("DOWNLOAD_MODAL_LOAD"),i.$emit("buy",t),n.next=4;break;case 3:"subscription"===e&&i.$emit("subscription",t);case 4:case"end":return n.stop()}},n)}))()}}},h=(i(1032),i(32)),p=Object(h.a)(d,function(){var t=this,e=t._self._c;return e("section",{staticClass:"horizontal-list-container item mt-lg-2 pt-3",attrs:{id:"watching"}},[e("div",{staticClass:"container-fluid mb-3"},[e("div",{staticClass:"row align-items-center container-fluid-header"},[e("div",{staticClass:"col-6 col-md-auto"},[e("b-dropdown",{staticClass:"season-dropdown",attrs:{text:t.seasontitle,variant:"main",size:"md"}},t._l(t.season,function(i,n){return e("b-dropdown-item",{key:n,attrs:{href:"#",active:t.selectseriesid==n},on:{click:function(e){return e.preventDefault(),t.$emit("select-season",n)}}},[t._v("\n            فصل "+t._s(n)+"\n          ")])}),1)],1),t._v(" "),e("div",{staticClass:"col-6 col-md-auto"},[e("b-dropdown",{staticClass:"sort-dropdown",attrs:{variant:"text",size:"md",right:""},scopedSlots:t._u([{key:"button-content",fn:function(){return[e("i",{class:t.sortButtonIcon}),t._v("\n            "+t._s(t.sortButtonLabel)+"\n          ")]},proxy:!0}])},[t._v(" "),t._l(t.sortOptions,function(i){return e("b-dropdown-item",{key:i.value,attrs:{active:t.sortOrder===i.value},on:{click:function(e){return t.setSortOrder(i.value)}}},[e("i",{class:i.icon}),t._v("\n            "+t._s(i.label)+"\n          ")])})],2)],1)])]),t._v(" "),t.description?e("div",{staticClass:"container-fluid mb-4"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("p",{staticClass:"series-description text-light"},[t._v("\n          "+t._s(t.description)+"\n        ")])])])]):t._e(),t._v(" "),e("div",{staticClass:"container-fluid"},[e("div",{staticClass:"row"},t._l(t.displayedEpisodes,function(i,n){return e("div",{key:n,staticClass:"col-lg-3 col-md-6 col-6 mb-3"},[e("div",{staticClass:"episode-card"},[e("nuxt-link",{staticClass:"episode-image-link",attrs:{to:{name:"episode-id",params:{id:i.id}}}},[e("div",{staticClass:"episode-image-wrapper"},[e("OptimizedImage",{staticClass:"episode-image",attrs:{"image-src":i.backdrop,alt:i.name,width:364,height:170,"thumb-options":{w:364,h:170,q:100,a:"t"},type:"backdrops","fluid-grow":"","aspect-ratio":364/170}}),t._v(" "),t.$auth.loggedIn&&i.current_time>0?e("div",{staticClass:"progress"},[e("div",{staticClass:"progress-bar",style:"width: "+i.current_time/i.duration_time*100+"%",attrs:{role:"progressbar","aria-valuenow":"0","aria-valuemin":"0","aria-valuemax":"100"}})]):t._e()],1)]),t._v(" "),e("div",{staticClass:"episode-content"},[e("h6",{staticClass:"episode-title"},[t._v("\n              "+t._s(t.ChooseLang(i.name,i.name_fa))+"\n            ")]),t._v(" "),t.getMainButton(i).exist&&"buy"===t.getMainButtonAction(i)&&t.isEpisodeInCart(i.id)?e("button",{staticClass:"episode-remove-btn",on:{click:function(e){return t.removeEpisodeFromCart(i)}}},[t._v("\n              حذف از سبد\n              "),e("i",{staticClass:"fa fa-trash mr-2"})]):t.getMainButton(i).exist?e("button",{staticClass:"episode-play-btn",on:{click:function(e){t.handleAction(i,t.getMainButtonAction(i))}}},[t._v("\n              "+t._s(t.getMainButtonLabel(i))+"\n              "),e("i",{class:t.getMainButtonIcon(i)})]):e("nuxt-link",{staticClass:"episode-play-btn",attrs:{to:{name:"episode-id",params:{id:i.id}}}},[t._v("\n              تماشا\n              "),e("i",{staticClass:"fa fa-play mr-2"})])],1)],1)])}),0),t._v(" "),t.hasMoreEpisodes?e("div",{staticClass:"row mt-3 mb-5 mb-sm-4"},[e("div",{staticClass:"col-12"},[e("div",{staticClass:"show-more-container"},[e("div",{staticClass:"show-more-divider"}),t._v(" "),e("b-button",{staticClass:"show-more-btn",attrs:{variant:"outline-light"},on:{click:t.toggleShowMore}},[t._v("\n            "+t._s(t.showAll?"مشاهده کمتر":"مشاهده بیشتر")+"\n            "),e("i",{class:t.showAll?"fa fa-chevron-up":"fa fa-chevron-down"})]),t._v(" "),e("div",{staticClass:"show-more-divider"})],1)])]):t._e()])])},[],!1,null,"105c4484",null);e.default=p.exports},736:function(t,e,i){t.exports={}},738:function(t,e,i){"use strict";i(736)},741:function(t,e,i){"use strict";i.r(e);var n=i(46),s=(i(35),i(73),i(142),i(174),i(13),i(62),i(60),i(19),i(65),i(122),i(14)),r={name:"OptimizedImage",props:{imageSrc:{type:String,default:""},alt:{type:String,required:!0},width:{type:[String,Number],default:null},height:{type:[String,Number],default:null},thumbOptions:{type:Object,default:function(){return{w:null,h:null,q:100,a:"c",zc:null,src:""}}},type:{type:String,default:"posters",validator:function(t){return["posters","backdrops","casts","files","backstage","next"].includes(t)}},fluidGrow:{type:Boolean,default:!1},blank:{type:Boolean,default:!0},blankColor:{type:String,default:"#bbb"},show:{type:Boolean,default:!0},classNames:{type:String,default:""},aspectRatio:{type:String,default:null}},computed:{computedProps:function(){var t={blank:this.blank,blankColor:this.blankColor,show:this.show};return this.fluidGrow?t.fluidGrow=!0:this.width&&this.height&&(t.width=this.width,t.height="full"===this.height?"100%":this.height),t},computedSrc:function(){var t=new URLSearchParams;if(Object.entries(this.thumbOptions).forEach(function(e){var i=Object(n.a)(e,2),s=i[0],r=i[1];null!==r&&""!==r&&t.set(s,r)}),!t.get("src")){if(!this.imageSrc)return;t.set("src","https://cdn.upera.shop/s3/".concat(this.type,"/").concat(this.imageSrc))}return"backstage"===this.type||"next"===this.type?"https://thumb.upera.shop/thumb?w=382&h=220&q=100&a=t&src=https://cdn.upera.shop/s3/".concat(this.imageSrc):"https://thumb.upera.shop/thumb?"+t.toString()}}},a=function(){Object(s.useCssVars)(function(t,e){return{"38ad01aa":t.aspectRatio}})},o=r.setup;r.setup=o?function(t,e){return a(),o(t,e)}:a;var c=r,u=(i(738),i(32)),l=Object(u.a)(c,function(){var t=this,e=t._self._c;return e("div",[e("b-img",t._g(t._b({directives:[{name:"lazy-load",rawName:"v-lazy-load"},{name:"lazy",rawName:"v-lazy",value:t.computedSrc,expression:"computedSrc"}],staticClass:"img-grid-flow",class:"full"===t.height?"h-full":" "+t.classNames,attrs:{blank:"","blank-color":"#bbb",show:"",width:t.width,height:"full"===t.height?"600px":t.height,"data-src":t.computedSrc,alt:t.alt,rounded:"lg",loading:"lazy"}},"b-img",t.computedProps,!1),t.$listeners))],1)},[],!1,null,"0f99ba96",null);e.default=l.exports},895:function(t,e,i){t.exports={}}}]);